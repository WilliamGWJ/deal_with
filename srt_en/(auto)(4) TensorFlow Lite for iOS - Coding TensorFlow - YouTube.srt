1
00:00:01,650 --> 00:00:03,259
[Applause]

2
00:00:03,259 --> 00:00:05,879
hi and welcome to coding tensorflow

3
00:00:05,879 --> 00:00:07,470
where you'll learn all about coding

4
00:00:07,470 --> 00:00:09,269
machine learning and AI apps using

5
00:00:09,269 --> 00:00:11,519
tensorflow I'm Laurence Moroney a

6
00:00:11,519 --> 00:00:13,200
developer advocate for tensorflow

7
00:00:13,200 --> 00:00:15,089
and today I'll be looking at tensorflow

8
00:00:15,089 --> 00:00:18,050
Lite and getting it to run models on iOS

9
00:00:18,050 --> 00:00:20,279
tensorflow Lite is a lightweight

10
00:00:20,279 --> 00:00:22,350
solution for mobile and embedded devices

11
00:00:22,350 --> 00:00:24,960
and lets you run machine learn models on

12
00:00:24,960 --> 00:00:27,210
mobile devices with low latency quickly

13
00:00:27,210 --> 00:00:29,310
so you can take advantage of them to do

14
00:00:29,310 --> 00:00:31,710
classification regression or anything

15
00:00:31,710 --> 00:00:33,540
else you might want without necessarily

16
00:00:33,540 --> 00:00:36,000
incurring a round trip to a server it's

17
00:00:36,000 --> 00:00:37,680
presently supported on both Android and

18
00:00:37,680 --> 00:00:40,950
iOS via a C++ API and today we're going

19
00:00:40,950 --> 00:00:42,870
to take a look at an iOS app that uses

20
00:00:42,870 --> 00:00:46,590
this API in Xcode here you can see me

21
00:00:46,590 --> 00:00:48,480
playing with an app on my iPad and I'm

22
00:00:48,480 --> 00:00:50,370
using it to classify a number of objects

23
00:00:50,370 --> 00:00:52,800
it's a lot of fun to play with and note

24
00:00:52,800 --> 00:00:54,750
how the interpretation of objects

25
00:00:54,750 --> 00:00:57,180
changes as I move the camera around it

26
00:00:57,180 --> 00:00:59,489
thinks my phone is an iPod for example

27
00:00:59,489 --> 00:01:01,500
it does a great job at detecting a mug

28
00:01:01,500 --> 00:01:03,629
but it thinks my SmartWatch is a digital

29
00:01:03,629 --> 00:01:05,400
watch well why is that

30
00:01:05,400 --> 00:01:07,140
well that's because this network is

31
00:01:07,140 --> 00:01:09,750
trained on a limited number of items it

32
00:01:09,750 --> 00:01:11,790
will see any phone as an iPod and any

33
00:01:11,790 --> 00:01:14,340
watch as a digital watch the nice thing

34
00:01:14,340 --> 00:01:15,930
about it though is that nets like this

35
00:01:15,930 --> 00:01:18,119
can be retrained but for now let's just

36
00:01:18,119 --> 00:01:20,640
stick with this one so how does all of

37
00:01:20,640 --> 00:01:23,340
this work first let's talk about the

38
00:01:23,340 --> 00:01:25,890
model the app is using a mobile net

39
00:01:25,890 --> 00:01:28,290
model and mobile nets are small low

40
00:01:28,290 --> 00:01:30,689
latency low-power models that are

41
00:01:30,689 --> 00:01:32,400
designed to meet a number of use cases

42
00:01:32,400 --> 00:01:35,430
such as object detection face attributes

43
00:01:35,430 --> 00:01:37,829
fine grain classification and landmark

44
00:01:37,829 --> 00:01:40,350
recognition what's nice about them is

45
00:01:40,350 --> 00:01:41,970
that there are a number of different

46
00:01:41,970 --> 00:01:44,369
ones that are pre-trained including the

47
00:01:44,369 --> 00:01:46,500
set at this link which works for image

48
00:01:46,500 --> 00:01:48,570
classification and it's compatible with

49
00:01:48,570 --> 00:01:51,600
tensorflow lite download that file and

50
00:01:51,600 --> 00:01:54,060
you'll unzip it to see two files a docx

51
00:01:54,060 --> 00:01:56,700
TF Lite file describing the model and a

52
00:01:56,700 --> 00:01:58,860
labels file describing the labels that

53
00:01:58,860 --> 00:02:01,290
it's trained for as you can see because

54
00:02:01,290 --> 00:02:03,570
your model is already in the dot TF Lite

55
00:02:03,570 --> 00:02:05,909
format it's ready to be run on

56
00:02:05,909 --> 00:02:08,340
tensorflow lite so let's take a look at

57
00:02:08,340 --> 00:02:11,039
the API is for that in fact though I

58
00:02:11,039 --> 00:02:12,569
would recommend that you stick with

59
00:02:12,569 --> 00:02:13,900
these pre-built models for the

60
00:02:13,900 --> 00:02:16,689
time being as TF fly is a Developer

61
00:02:16,689 --> 00:02:18,670
Preview it doesn't support all the

62
00:02:18,670 --> 00:02:20,950
operations of tensorflow yet and you

63
00:02:20,950 --> 00:02:22,780
might encounter some issues with

64
00:02:22,780 --> 00:02:24,970
unsupported ones when you're converting

65
00:02:24,970 --> 00:02:27,430
your model to the TF light format okay

66
00:02:27,430 --> 00:02:29,530
let's get down to looking at it on an

67
00:02:29,530 --> 00:02:32,590
iOS mobile now before you can code the

68
00:02:32,590 --> 00:02:35,049
app you'll need the universal iOS

69
00:02:35,049 --> 00:02:37,659
library for tensorflow light you can

70
00:02:37,659 --> 00:02:39,400
build this yourself thankfully from open

71
00:02:39,400 --> 00:02:41,859
source and if you don't have Xcode

72
00:02:41,859 --> 00:02:43,900
already you'll need to go ahead and get

73
00:02:43,900 --> 00:02:45,940
it from the App Store you'll also have

74
00:02:45,940 --> 00:02:48,159
to install and run Xcode for the first

75
00:02:48,159 --> 00:02:50,349
time you need to do this to agree to the

76
00:02:50,349 --> 00:02:52,239
license before you can use any of the

77
00:02:52,239 --> 00:02:54,310
Xcode tools including the command-line

78
00:02:54,310 --> 00:02:56,319
tools go ahead and get that done I'll

79
00:02:56,319 --> 00:03:01,400
wait

80
00:03:01,400 --> 00:03:03,960
okay you'll also need to install

81
00:03:03,960 --> 00:03:06,030
homebrew which you can get at the URL

82
00:03:06,030 --> 00:03:08,790
brooder sh this is a pretty neat package

83
00:03:08,790 --> 00:03:10,350
manager' and you're going to use that to

84
00:03:10,350 --> 00:03:13,440
install auto make and Lib tool and when

85
00:03:13,440 --> 00:03:15,480
they're done there's a script intensive

86
00:03:15,480 --> 00:03:17,220
flow that you can run which does all the

87
00:03:17,220 --> 00:03:18,959
building it's going to take a little

88
00:03:18,959 --> 00:03:20,730
while so sit back and have a coffee

89
00:03:20,730 --> 00:03:23,190
while you're waiting once you're done

90
00:03:23,190 --> 00:03:26,340
you can go to the examples iOS camera

91
00:03:26,340 --> 00:03:28,560
directory to find the source code for

92
00:03:28,560 --> 00:03:29,910
the sample app that I showed a moment

93
00:03:29,910 --> 00:03:32,400
ago don't forget to run pod install in

94
00:03:32,400 --> 00:03:35,040
that directory before you continue once

95
00:03:35,040 --> 00:03:36,900
you're done you can now load the code

96
00:03:36,900 --> 00:03:39,660
into Xcode and you can run it do note

97
00:03:39,660 --> 00:03:41,519
that you will need an iOS device to run

98
00:03:41,519 --> 00:03:43,050
it on it doesn't yet work in the

99
00:03:43,050 --> 00:03:45,690
simulator in Xcode if you open the

100
00:03:45,690 --> 00:03:47,310
project navigator you'll see a data

101
00:03:47,310 --> 00:03:49,860
folder this contains a TF flight file

102
00:03:49,860 --> 00:03:52,019
containing the model and its hex file

103
00:03:52,019 --> 00:03:54,900
containing the labels it probably has

104
00:03:54,900 --> 00:03:56,550
the quantized version of the model as

105
00:03:56,550 --> 00:03:57,900
you can see from the quant in the file

106
00:03:57,900 --> 00:04:00,239
name you can replace these with the

107
00:04:00,239 --> 00:04:01,650
model and labels that you downloaded

108
00:04:01,650 --> 00:04:03,690
earlier or if you like just keep them

109
00:04:03,690 --> 00:04:06,720
the way that they are open the camera

110
00:04:06,720 --> 00:04:09,480
example viewcontroller mm file and

111
00:04:09,480 --> 00:04:11,579
you'll see some constants at the top of

112
00:04:11,579 --> 00:04:13,650
the file which specify the name of the

113
00:04:13,650 --> 00:04:15,660
model and labels to load if you've

114
00:04:15,660 --> 00:04:17,870
changed it you'll need to update these

115
00:04:17,870 --> 00:04:20,549
to use TF flight you'll need an

116
00:04:20,549 --> 00:04:22,800
interpreter and this can be loaded from

117
00:04:22,800 --> 00:04:26,370
the API as an interpreter object to this

118
00:04:26,370 --> 00:04:28,169
you'll input details of the captured

119
00:04:28,169 --> 00:04:30,360
frame and it will output a set of

120
00:04:30,360 --> 00:04:32,580
probabilities whether or not it sees

121
00:04:32,580 --> 00:04:34,410
something that matches each of the

122
00:04:34,410 --> 00:04:37,020
possible labels let's take a look at the

123
00:04:37,020 --> 00:04:39,120
app again and here you can see I'm

124
00:04:39,120 --> 00:04:41,370
looking at a mug but it's giving me back

125
00:04:41,370 --> 00:04:43,680
a couple of labels once for a mug and

126
00:04:43,680 --> 00:04:45,690
once for a cup well what's actually

127
00:04:45,690 --> 00:04:48,360
happening here the app is capturing

128
00:04:48,360 --> 00:04:50,520
frames from the camera and feeding them

129
00:04:50,520 --> 00:04:53,100
one by one into the interpreter the

130
00:04:53,100 --> 00:04:56,100
model that's loaded is a 224 by 224 one

131
00:04:56,100 --> 00:04:58,320
so the images will first get resized to

132
00:04:58,320 --> 00:05:01,320
that with this code the interpreter then

133
00:05:01,320 --> 00:05:03,450
outputs a tensor containing all of the

134
00:05:03,450 --> 00:05:05,940
results and this will be an index of all

135
00:05:05,940 --> 00:05:07,680
of the labels with an Associated

136
00:05:07,680 --> 00:05:10,830
probability the get top n function is a

137
00:05:10,830 --> 00:05:12,810
helper function which pulls out the top

138
00:05:12,810 --> 00:05:15,420
few of these I put a breakpoint

139
00:05:15,420 --> 00:05:16,830
there to show what happens with the

140
00:05:16,830 --> 00:05:19,440
output here you can see that the top

141
00:05:19,440 --> 00:05:21,090
value when I pointed the camera at the

142
00:05:21,090 --> 00:05:23,490
coffee mug was the interpreter gave me

143
00:05:23,490 --> 00:05:26,220
back is 74 percent probability that it

144
00:05:26,220 --> 00:05:29,040
was the object at label 505 and if you

145
00:05:29,040 --> 00:05:30,780
look at the list of labels you'll see

146
00:05:30,780 --> 00:05:32,280
that the five or fifth one is a coffee

147
00:05:32,280 --> 00:05:34,710
mug it shows us five or six because when

148
00:05:34,710 --> 00:05:36,480
Xcode prints out the list it starts at

149
00:05:36,480 --> 00:05:38,580
one but the in memory one starts at zero

150
00:05:38,580 --> 00:05:41,430
it's still a coffee mug so that's a

151
00:05:41,430 --> 00:05:43,680
starter in tensorflow light for iOS this

152
00:05:43,680 --> 00:05:45,420
exciting technology will let you load

153
00:05:45,420 --> 00:05:47,160
your models onto a device taking

154
00:05:47,160 --> 00:05:49,320
advantage of onboard hardware and allow

155
00:05:49,320 --> 00:05:51,210
you to execute them I showed an example

156
00:05:51,210 --> 00:05:53,220
using image recognition in a video

157
00:05:53,220 --> 00:05:54,990
stream but of course you're not limited

158
00:05:54,990 --> 00:05:57,510
to that at the moment tensorflow light

159
00:05:57,510 --> 00:05:59,850
is in Developer Preview so remember you

160
00:05:59,850 --> 00:06:01,920
may encounter some restrictions using

161
00:06:01,920 --> 00:06:03,630
the tensorflow api's that are not

162
00:06:03,630 --> 00:06:05,490
supported but we are updating them all

163
00:06:05,490 --> 00:06:07,830
the time finally if you want to learn

164
00:06:07,830 --> 00:06:10,050
more including how to retrain the model

165
00:06:10,050 --> 00:06:12,060
I showed in this video to tailor it for

166
00:06:12,060 --> 00:06:14,220
specific scenarios check out the

167
00:06:14,220 --> 00:06:16,050
tensorflow for poet's code labs on the

168
00:06:16,050 --> 00:06:18,540
google developer site I can't wait to

169
00:06:18,540 --> 00:06:20,070
see what you build on mobile with TF

170
00:06:20,070 --> 00:06:21,510
Lite and don't forget to hit that

171
00:06:21,510 --> 00:06:23,280
subscribe button for more great coding

172
00:06:23,280 --> 00:06:26,340
with tensorflow videos don't forget to

173
00:06:26,340 --> 00:06:27,630
click the subscribe button for more

174
00:06:27,630 --> 00:06:30,620
great videos like these what's

